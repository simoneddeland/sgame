/*! SGame by Simon Eddeland */
function KeyboardState(a){this.pressed=a}function MouseState(a){this.x=a.x,this.y=a.y,this.leftButtonDown=a.leftButton,this.rightButtonDown=a.rightButton,this.middleButtonDown=a.middleButton}function Vector2(a,b){this.x=a||0,this.y=b||0}function Rectangle(a,b,c,d){this.x=a||0,this.y=b||0,this.width=c||0,this.height=d||0}function ContentManager(){this.images={},this.audioObjects={},this.checkLoadStatus=function(){var a=this.getLoadingInfo();console.log("Loading status: "+a.loadedImg+"/"+a.totalImg+" images, "+a.loadedAudio+"/"+a.totalAudio+" audio files"),a.loadedImg===a.totalImg&&a.loadedAudio===a.totalAudio&&null!==this.onAllContentLoaded&&this.onAllContentLoaded()},this.onAllContentLoaded=null}function Drawer(a){var b=document.getElementById(a);b.oncontextmenu=function(){return!1},this.ctx=b.getContext("2d")}var SGame={},Keys={Back:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,Escape:27,Space:32,Left:37,Up:38,Right:39,Down:40,Delete:46,D0:48,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90};KeyboardState.prototype={isKeyDown:function(a){return this.pressed[a]},isKeyUp:function(a){return!this.pressed[a]}};var Keyboard=function(){var a={},b=function(b){a[b.keyCode]=!0},c=function(b){delete a[b.keyCode]},d=function(){return new KeyboardState(JSON.parse(JSON.stringify(a)))};return{onKeyDown:b,onKeyUp:c,getState:d}}();window.addEventListener("keyup",function(a){Keyboard.onKeyUp(a)},!1),window.addEventListener("keydown",function(a){Keyboard.onKeyDown(a)},!1),MouseState.prototype={};var Mouse=function(){var a={x:0,y:0,leftButton:!1,middleButton:!1,rightButton:!1},b=document.getElementById("sgame"),c=function(c){var d=b.getBoundingClientRect();a.x=(c.clientX-d.left)/(d.right-d.left)*b.width,a.y=(c.clientY-d.top)/(d.bottom-d.top)*b.height},d=function(a){f(a.buttons)},e=function(a){f(a.buttons)},f=function(b){b=b>=16?b-16:b,b=b>=8?b-8:b,b>=4?(b-=4,a.middleButton=!0):a.middleButton=!1,b>=2?(b-=2,a.rightButton=!0):a.rightButton=!1,b>=1?(b-=1,a.leftButton=!0):a.leftButton=!1},g=function(){return new MouseState(JSON.parse(JSON.stringify(a)))};return{onMove:c,onButtonDown:d,onButtonUp:e,getState:g}}();window.addEventListener("mousemove",function(a){Mouse.onMove(a)},!1),window.addEventListener("mousedown",function(a){Mouse.onButtonDown(a)},!1),window.addEventListener("mouseup",function(a){Mouse.onButtonUp(a)},!1),Vector2.prototype={imuls:function(a){this.x*=a,this.y*=a},iadd:function(a){this.x+=a.x,this.y+=a.y},getLength:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},Rectangle.prototype={intersects:function(a){return this.x<a.x+a.width&&this.x+this.width>a.x&&this.y<a.y+a.height&&this.y+this.height>a.y}},ContentManager.prototype={loadImage:function(a){var b=this,c=this.images;return c[a]=new Image,c[a].loaded=!1,c[a].onload=function(){console.log("Loaded new "+a),c[a].loaded=!0,b.checkLoadStatus()},c[a]},getImage:function(a){return this.images[a]},loadAudio:function(a){var b=this,c=this.audioObjects;return c[a]=null,c[a]=new Howl({src:["audio/"+a],preload:!1,onload:function(){console.log("Loaded new "+a),c[a].loaded=!0,b.checkLoadStatus()}}),c[a].loaded=!1,c[a]},getAudio:function(a){return this.audioObjects[a]},getLoadingInfo:function(){var a=Object.keys(this.images).length,b=0,c=this.images,d=Object.keys(this.audioObjects).length,e=0,f=this.audioObjects;return Object.keys(c).forEach(function(a){c[a].loaded&&b++}),Object.keys(f).forEach(function(a){f[a].loaded&&e++}),{totalImg:a,loadedImg:b,totalAudio:d,loadedAudio:e}},startLoading:function(){var a=this.images,b=this.audioObjects;Object.keys(a).forEach(function(b){a[b].src="img/"+b,console.log("Loading "+b)}),Object.keys(b).forEach(function(a){b[a].load(),console.log("Loading "+a)})}},SGame.Canvas=function(){var a=document.getElementById("sgame"),b=function(b){a.height=b.height,a.width=b.width},c=function(){return{width:a.width,height:a.height}};return{setSize:b,getSize:c}}(),Drawer.prototype={draw:function(a,b,c,d){b.width="undefined"!=typeof b.width?b.width:a.width,b.height="undefined"!=typeof b.height?b.height:a.height,"undefined"!=typeof c?(d="undefined"==typeof d?{x:b.width/2,y:b.height/2}:d,this.ctx.save(),this.ctx.translate(b.x+d.x,b.y+d.y),this.ctx.rotate(c*Math.PI/180),this.ctx.drawImage(a,-d.x,-d.y,b.width,b.height),this.ctx.restore()):this.ctx.drawImage(a,b.x,b.y,b.width,b.height)},drawString:function(a,b,c,d){this.ctx.save(),this.ctx.fillStyle=d,this.ctx.font=c,this.ctx.fillText(a,b.x,b.y),this.ctx.restore()},clear:function(a){a="undefined"!=typeof a?a:"black";var b=SGame.Canvas.getSize();this.ctx.save(),this.ctx.clearRect(0,0,b.width,b.height),this.ctx.fillStyle=a,this.ctx.fillRect(0,0,b.width,b.height),this.ctx.restore()}},SGame.Game=function(){var a,b,c,d,e,g=(function(){return window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout}(),function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}()),h=function(){console.log("Initializing SGame"),a=new Drawer("sgame");var b=SGame.Canvas.getSize().width,f=SGame.Canvas.getSize().height,g=document.getElementById("sgameloading");g.style.display="block",g.style.top=f/2-g.height/2+"px",g.style.left=b/2-g.width/2+"px",d=new ContentManager,e=!1,d.onAllContentLoaded=i,console.log("Loading game content"),c.loadContent(d),d.startLoading(),d.checkLoadStatus()},i=function(){document.getElementById("sgameloading").style.display="none",console.log("Initializing game"),c.initialize(),console.log("Starting gameloop"),e=!0},j=function(){var a=Date.now(),d=(a-(b||a))/1e3;b=a,g(j),e?(c.update(d),c.draw()):k()},k=function(){var b=d.getLoadingInfo(),c=SGame.Canvas.getSize();a.clear(),a.drawString("Loading",{x:c.width/2-70,y:c.height/2-100},"36px sans-serif","white"),a.drawString(b.loadedImg+"/"+b.totalImg+" images",{x:c.width/2-50,y:c.height/2+100},"18px sans-serif","white"),a.drawString(b.loadedAudio+"/"+b.totalAudio+" sound files",{x:c.width/2-50,y:c.height/2+120},"18px sans-serif","white"),a.drawString("Powered by SGame",{x:c.width/2-100,y:c.height/2+160},"24px sans-serif","white")},l=function(a){c=a,h(),j()};return{start:l}}();